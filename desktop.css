/* 
 * Requirement:
 *   1. (left) sidebar nav is sticky
 *   2. header is fixed in the top
 *   3. footer has the "uncover the black bit by scrolling up"
 *   4. page-content-overlay for covering the main and footer
 *
 * The HTML elements' hierarchy:
 * * root
 *   * .wrapper (relative)
 *     * nav (fixed, z-index: 1)
 *     * header (fixed, z-index: 1)
 *     * main
 *     * footer
 *       * .footer-top
 *       * .footer-bottom (fixed, z-index: -1)
 *     * .page-content-overlay (fixed: z-index: auto)
 *
 * And the stacking context hierarchy:
 * * root stacking context  
 *   * nav (fixed, z-index: 1)
 *   * header (fixed, z-index: 1)
 *   * .page-content-overlay (fixed, z-index: auto)
 *   * main, footer, .footer-top
 *   * .footer-bottom (fixed, z-index: -1)
 *  
 * Read more about stacking context:
 * https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context
 */

.wrapper {
  position: relative;
}

/* 
 * nav is fixed by default, when scrolling to the bottom, it turns to
 * absolute for sticking above the footer (this done by Javascript).
 */

nav {
  position: fixed;
  top: 80px; /* top matches the fixed height of the header */

  width: 240px; /* fixed width, this matches the main's margin-left */
  /* flexible height that rely on the viewpoint and the header height */
  min-height: calc(100vh - 80px);
  overflow: hidden;

  /* 
   * a large enough vaule that makes sure the nav won't be covered
   * by the page-content-overlay
   */
  z-index: 1;
}

/* header always fixed in top */

header {
  position: fixed;
  top: 0;

  width: 100%; /* full width */

  /* 
   * fixed height, this matches: 
   *   1. the nav's top
   *   2. the nav's min-height
   *   3. the main's margin-top
   *   4. the main's min-height
   */
  height: 80px;

  /* 
   * a large enough vaule that makes sure the header won't be covered
   * by the page-content-overlay
   */
  z-index: 1;
}

/* main */

main {
  /* 
   * This makes the main working as expected in IE11.
   * 
   * The HTML5 main element is not supported by Internet Explorer,
   * read more: https://stackoverflow.com/a/35820454
   */
  display: block;

  margin-top: 80px; /* fixed margin-top matches the header height */
  margin-left: 240px; /* fixed margin-left matches the nav width */

  /* flexible height that rely on the viewpoint */
  min-height: calc(100vh - 80px);
}

/* footer has the "uncover the black bit by scrolling up" */

.footer-top {
  /* Fixed margin-bottom that matches the footer-bottom's height */
  margin-bottom: 400px;

  /* 
   * Fixed height, this is used by the scroll event to calculate the
   * nav's position.
   */
  height: 160px;
}

.footer-bottom {
  /* footer-bottom is fixed in the bottom */
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;

  /* 
   * A low enough z-index that make the footer-bottom always be
   * covered by the footer-top, main and page-content-overlay.
   */
  z-index: -1;

  /* Fixed height, this matches the footer-top's margin-bottom */
  height: 400px;
}

/* 
 * page-content-overlay is an overlay layer for covering the main and
 * footer. The nav and header should sits above the
 * page-content-overlay.
 */

.page-content-overlay {
  /* Layer that covers the whole viewpoint */
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;

  /* Invisible by default */
  opacity: 0;
  pointer-events: none;

  background: black;
  transition: opacity 0.3s linear;
}

/* Display the page-content-overlay */

.page-content-overlay.open {
  opacity: 0.8;

  /* Intercepting all pointer/mouse events */
  pointer-events: all;
}

/* Presentation Setup */

* {
  box-sizing: border-box;
}

html {
  font: 16px/1.5 sans-serif;
}

body {
  margin: 0;
}

header,
nav,
main,
footer {
  font-size: 2em;
}

header {
  background: greenyellow;
}

nav {
  background: goldenrod;
}

main {
  background: whitesmoke;
}

footer {
  background: lightcoral;
}

.footer-bottom {
  background: gray;
}
